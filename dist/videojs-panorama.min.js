
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsMyplayPanorama=t(e.videojs)}(this,function(e){"use strict";function t(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}function i(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function n(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function a(){return/iPhone|iPod/i.test(navigator.platform)}function s(e){var t=2/(e.leftTan+e.rightTan),i=(e.leftTan-e.rightTan)*t*.5,n=2/(e.upTan+e.downTan);return{scale:[t,n],offset:[i,(e.upTan-e.downTan)*n*.5]}}function o(e,t,i,n){t=void 0===t||t,i=void 0===i?.01:i,n=void 0===n?1e4:n;var a=t?-1:1,o=new THREE.Matrix4,r=o.elements,h=s(e);return r[0]=h.scale[0],r[1]=0,r[2]=h.offset[0]*a,r[3]=0,r[4]=0,r[5]=h.scale[1],r[6]=-h.offset[1]*a,r[7]=0,r[8]=0,r[9]=0,r[10]=n/(i-n)*-a,r[11]=n*i/(i-n),r[12]=0,r[13]=0,r[14]=a,r[15]=0,o.transpose(),o}function r(e,t,i,n){var a=Math.PI/180;return o({upTan:Math.tan(e.upDegrees*a),downTan:Math.tan(e.downDegrees*a),leftTan:Math.tan(e.leftDegrees*a),rightTan:Math.tan(e.rightDegrees*a)},t,i,n)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=e[i]);return t}function c(e){var t={};for(var i in e)t[i]=e[i];return t}function l(e){return Math.sqrt((e[0].clientX-e[1].clientX)*(e[0].clientX-e[1].clientX)+(e[0].clientY-e[1].clientY)*(e[0].clientY-e[1].clientY))}function d(e,t,i,n){function a(i){s=t(a,n),e(i-(o||i)),o=i}var s,o;return{start:function(){s||a(0)},stop:function(){i(s),s=null,o=0}}}function u(e){return d(e,requestAnimationFrame,cancelAnimationFrame)}function m(e,t,i,n){function a(t){Boolean(e[i])===Boolean(n)&&t.stopImmediatePropagation(),delete e[i]}return e.addEventListener(t,a,!1),a}function p(e,t,i,n){function a(){return i[t]}function s(e){i[t]=e}n&&s(e[t]),Object.defineProperty(e,t,{get:a,set:s})}function v(e,t,i){i.addEventListener(t,function(){return e.dispatchEvent(new Event(t))})}function g(e,t){Promise.resolve().then(function(){e.dispatchEvent(new Event(t))})}function f(e){var t=new Audio;return v(e,"play",t),v(e,"playing",t),v(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}function w(e,t,i){(_||0)+200<Date.now()&&(e[q]=!0,_=Date.now()),i||(e.currentTime=t),U[++B%3]=100*t|0}function b(e){return e.driver.currentTime>=e.video.duration}function y(e){var t=this;t.video.readyState>=t.video.HAVE_FUTURE_DATA?(t.hasAudio||(t.driver.currentTime=t.video.currentTime+e*t.video.playbackRate/1e3,t.video.loop&&b(t)&&(t.driver.currentTime=0)),w(t.video,t.driver.currentTime)):t.video.networkState!==t.video.NETWORK_IDLE||t.video.buffered.length||t.video.load(),t.video.ended&&(delete t.video[q],t.video.pause(!0))}function M(){var e=this,t=e[Y];e.webkitDisplayingFullscreen?e[H]():("data:"!==t.driver.src&&t.driver.src!==e.src&&(w(e,0,!0),t.driver.src=e.src),e.paused&&(t.paused=!1,e.buffered.length||e.load(),t.driver.play(),t.updater.start(),t.hasAudio||(g(e,"play"),t.video.readyState>=t.video.HAVE_ENOUGH_DATA&&g(e,"playing"))))}function x(e){var t=this,i=t[Y];i.driver.pause(),i.updater.stop(),t.webkitDisplayingFullscreen&&t[G](),i.paused&&!e||(i.paused=!0,i.hasAudio||g(t,"pause"),t.ended&&(t[q]=!0,g(t,"ended")))}function L(e,t){var i=e[Y]={};i.paused=!0,i.hasAudio=t,i.video=e,i.updater=u(y.bind(i)),t?i.driver=f(e):(e.addEventListener("canplay",function(){e.paused||g(e,"playing")}),i.driver={src:e.src||e.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,b(i)&&w(e,0)},get ended(){return b(i)}}),e.addEventListener("emptied",function(){var t=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==e.src&&(w(e,0,!0),i.driver.src=e.src,t?i.driver.play():i.updater.stop())},!1),e.addEventListener("webkitbeginfullscreen",function(){e.paused?t&&!i.driver.buffered.length&&i.driver.load():(e.pause(),e[H]())}),t&&(e.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=e.currentTime}),e.addEventListener("seeking",function(){U.indexOf(100*e.currentTime|0)<0&&(i.driver.currentTime=e.currentTime)}))}function T(e){var t=e[Y];e[H]=e.play,e[G]=e.pause,e.play=M,e.pause=x,p(e,"paused",t.driver),p(e,"muted",t.driver,!0),p(e,"playbackRate",t.driver,!0),p(e,"ended",t.driver),p(e,"loop",t.driver,!0),m(e,"seeking"),m(e,"seeked"),m(e,"timeupdate",q,!1),m(e,"ended",q,!1)}function k(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0),i&&!W||e[Y]||(L(e,t),T(e),e.classList.add("IIV"),!t&&e.autoplay&&e.play(),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}function R(e){var t=e.getChild("Canvas");return function(){e.el().style.width=window.innerWidth+"px",e.el().style.height=window.innerHeight+"px",t.handleResize()}}function P(e,t){var i=R(e);e.controlBar.fullscreenToggle.off("tap",t),e.controlBar.fullscreenToggle.on("tap",function(){var t=e.getChild("Canvas");e.isFullscreen()?(e.isFullscreen(!1),e.exitFullWindow(),e.el().style.width="",e.el().style.height="",t.handleResize(),window.removeEventListener("devicemotion",i)):(e.isFullscreen(!0),e.enterFullWindow(),i(),window.addEventListener("devicemotion",i))})}function C(e){return e.tech({IWillNotUseThisInPlugins:!0}).el()}function V(e){return e.controlBar.fullscreenToggle.handleClick}function S(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}e="default"in e?e.default:e;var E={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,Check_Version:function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){t=navigator.userAgent;null!==(i=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})")).exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName)if(-1!==navigator.appVersion.indexOf("Trident"))e=11;else{var t=navigator.userAgent,i=new RegExp("Edge/([0-9]{1,}[\\.0-9]{0,})");null!==i.exec(t)&&(e=parseFloat(RegExp.$1))}return e},supportVideoTexture:function(){var e=this.Check_Version();return-1===e||e>=13},isLiveStreamOnSafari:function(e){var t=[].slice.call(e.querySelectorAll("source")),i=!1;e.src&&e.src.indexOf(".m3u8")>-1&&t.push({src:e.src,type:"application/x-mpegURL"});for(var n=0;n<t.length;n++){var a=t[n];if(("application/x-mpegURL"===a.type||"application/vnd.apple.mpegurl"===a.type)&&/(Safari|AppleWebKit)/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)){i=!0;break}}return i},getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,i,n;t=void 0!==(e=e||{}).parent?e.parent:document.body,i=void 0!==e.id?e.id:"oldie",(n=E.getWebGLErrorMessage()).id=i,t.appendChild(n)}},D={prev_currentTime:0,counter:0,isBuffering:function(e){return e==this.prev_currentTime?this.counter++:this.counter=0,this.prev_currentTime=e,this.counter>10&&(this.counter=10,!0)}},F={whichTransitionEvent:t,mobileAndTabletcheck:i,isIos:n,isRealIphone:a,fovToProjection:r,extend:h,deepCopy:c,getTouchesDistance:l},j=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{constructor:function(n,a){this.settings=a,this.width=n.el().offsetWidth,this.height=n.el().offsetHeight,this.lon=a.initLon,this.lat=a.initLat,this.phi=0,this.theta=0,this.videoType=a.videoType,this.clickToToggle=a.clickToToggle,this.mouseDown=!1,this.isUserInteracting=!1,this.renderer=new t.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.autoClear=!1,this.renderer.setClearColor(0,1);var s=i.getTech(n);if(this.supportVideoTexture=E.supportVideoTexture(),this.liveStreamOnSafari=E.isLiveStreamOnSafari(s),this.liveStreamOnSafari&&(this.supportVideoTexture=!1),this.supportVideoTexture)this.texture=new t.Texture(s);else{this.helperCanvas=n.addChild("HelperCanvas",{video:s,width:a.helperCanvas.width?a.helperCanvas.width:this.width,height:a.helperCanvas.height?a.helperCanvas.height:this.height});var o=this.helperCanvas.el();this.texture=new t.Texture(o)}s.style.visibility="hidden",this.texture.generateMipmaps=!1,this.texture.minFilter=t.LinearFilter,this.texture.maxFilter=t.LinearFilter,this.texture.format=t.RGBFormat,this.el_=this.renderer.domElement,this.el_.classList.add("vjs-video-canvas"),a.el=this.el_,e.call(this,n,a),this.attachControlEvents(),this.player().on("play",function(){this.time=(new Date).getTime(),this.startAnimation()}.bind(this))},setMyPlayScript:function(e){this.myPlayScript=e},attachControlEvents:function(){this.on("mousemove",this.handleMouseMove.bind(this)),this.on("touchmove",this.handleTouchMove.bind(this)),this.on("mousedown",this.handleMouseDown.bind(this)),this.on("touchstart",this.handleTouchStart.bind(this)),this.on("mouseup",this.handleMouseUp.bind(this)),this.on("touchend",this.handleTouchEnd.bind(this)),this.on("myPlayScript",this.handleMyPlayScript.bind(this)),this.settings.scrollable&&(this.on("mousewheel",this.handleMouseWheel.bind(this)),this.on("MozMousePixelScroll",this.handleMouseWheel.bind(this))),this.on("mouseenter",this.handleMouseEnter.bind(this)),this.on("mouseleave",this.handleMouseLease.bind(this)),this.on("dispose",this.handleDispose.bind(this))},handleDispose:function(e){this.off("mousemove",this.handleMouseMove.bind(this)),this.off("touchmove",this.handleTouchMove.bind(this)),this.off("mousedown",this.handleMouseDown.bind(this)),this.off("touchstart",this.handleTouchStart.bind(this)),this.off("mouseup",this.handleMouseUp.bind(this)),this.off("touchend",this.handleTouchEnd.bind(this)),this.settings.scrollable&&(this.off("mousewheel",this.handleMouseWheel.bind(this)),this.off("MozMousePixelScroll",this.handleMouseWheel.bind(this))),this.off("mouseenter",this.handleMouseEnter.bind(this)),this.off("mouseleave",this.handleMouseLease.bind(this)),this.off("dispose",this.handleDispose.bind(this)),this.stopAnimation()},startAnimation:function(){this.render_animation=!0,this.animate()},stopAnimation:function(){this.render_animation=!1,this.requestAnimationId&&cancelAnimationFrame(this.requestAnimationId)},handleResize:function(){this.width=this.player().el().offsetWidth,this.height=this.player().el().offsetHeight,this.renderer.setSize(this.width,this.height)},handleMouseUp:function(e){if(this.mouseDown=!1,this.clickToToggle){var t=e.clientX||e.changedTouches&&e.changedTouches[0].clientX,i=e.clientY||e.changedTouches&&e.changedTouches[0].clientY;if(void 0===t||"undefined"===i)return;var n=Math.abs(t-this.onPointerDownPointerX),a=Math.abs(i-this.onPointerDownPointerY);n<.1&&a<.1&&(this.player().paused()?this.player().play():this.player().pause()),console.log("'"+Math.round(this.player().currentTime())+"' : {'zoom' : "+this.camera.fov+", 'lat' : "+Math.round(this.lat)+",'lon' : "+Math.round(this.lon)+"},")}},handleMouseDown:function(e){e.preventDefault();var t=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;void 0!==t&&"undefined"!==i&&(this.mouseDown=!0,this.onPointerDownPointerX=t,this.onPointerDownPointerY=i,this.onPointerDownLon=this.lon,this.onPointerDownLat=this.lat)},handleTouchStart:function(e){this.isUserInteracting=!0,e.touches.length>1&&(this.isUserPinch=!0,this.multiTouchDistance=F.getTouchesDistance(e.touches)),this.handleMouseDown(e)},handleTouchEnd:function(e){this.isUserInteracting=!1,this.isUserPinch=!1,this.handleMouseUp(e)},handleMyPlayScript:function(e){console.log("this.isUserInteracting: "+this.isUserInteracting);var t=Math.round(this.player().currentTime());this.lastTimeRead==this.player().currentTime()?(this.settings.initLat=this.settings.originalInitLat,this.settings.initLon=this.settings.originalInitLon):void 0==this.myPlayScript[t]||this.isUserInteracting||(this.setMaxLatAndLon(this.myPlayScript[t].zoom),this.settings.initLat=this.myPlayScript[t].lat,this.settings.initLon=this.myPlayScript[t].lon,this.camera.fov!=this.myPlayScript[t].zoom&&setTimeout(function(){this.fixZoom(this.myPlayScript[t].zoom)}.bind(this),100)),this.lastTimeRead=this.player().currentTime(),setTimeout(function(){this.handleMyPlayScript()}.bind(this),1e3)},fixZoom:function(e){this.camera.fov>e&&(this.camera.fov-=1),this.camera.fov<e&&(this.camera.fov+=1),this.camera.updateProjectionMatrix(),this.setMaxLatAndLon(e),this.camera.fov!=e&&setTimeout(function(){this.fixZoom(e)}.bind(this),10)},setMaxLatAndLon:function(e){this.settings.maxLon=this.settings.originalMaxLon-(e-this.settings.minFov)/6*4,this.settings.minLon=this.settings.originalMinLon+(e-this.settings.minFov)/6*4,this.settings.minLat=this.settings.originalMinLat+(e-this.settings.minFov)/6*3,this.settings.maxLat=this.settings.originalMaxLat-(e-this.settings.minFov)/6*3},handleMouseMove:function(e){var t=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;if(void 0!==t&&"undefined"!==i)if(this.settings.clickAndDrag)this.mouseDown&&(this.lon=.2*(this.onPointerDownPointerX-t)+this.onPointerDownLon,this.lat=.2*(i-this.onPointerDownPointerY)+this.onPointerDownLat);else{var n=t-this.el_.offsetLeft,a=i-this.el_.offsetTop;this.lon=n/this.width*430-225,this.lat=a/this.height*-180+90}},handleTouchMove:function(e){(!this.isUserPinch||e.touches.length<=1)&&this.handleMouseMove(e),this.settings.initLat=this.lat,this.settings.initLon=this.lon},handleMobileOrientation:function(e){if(void 0!==e.rotationRate){var t=e.rotationRate.alpha,i=e.rotationRate.beta,n=void 0!==e.portrait?e.portrait:window.matchMedia("(orientation: portrait)").matches,a=void 0!==e.landscape?e.landscape:window.matchMedia("(orientation: landscape)").matches,s=e.orientation||window.orientation;if(n)this.lon=this.lon-i*this.settings.mobileVibrationValue,this.lat=this.lat+t*this.settings.mobileVibrationValue;else if(a){var o=-90;void 0!==s&&(o=s),this.lon=-90==o?this.lon+t*this.settings.mobileVibrationValue:this.lon-t*this.settings.mobileVibrationValue,this.lat=-90==o?this.lat+i*this.settings.mobileVibrationValue:this.lat-i*this.settings.mobileVibrationValue}}},handleMouseWheel:function(e){e.stopPropagation(),e.preventDefault()},handleMouseEnter:function(e){this.isUserInteracting=!0},handleMouseLease:function(e){this.isUserInteracting=!1,this.mouseDown&&(this.mouseDown=!1)},animate:function(){if(this.render_animation){if(this.requestAnimationId=requestAnimationFrame(this.animate.bind(this)),!this.player().paused()&&void 0!==this.texture&&(!this.isPlayOnMobile&&this.player().readyState()>=2||this.isPlayOnMobile&&this.player().hasClass("vjs-playing"))){var e=(new Date).getTime();if(e-this.time>=30&&(this.texture.needsUpdate=!0,this.time=e),this.isPlayOnMobile){var t=this.player().currentTime();D.isBuffering(t)?this.player().hasClass("vjs-panorama-mobile-inline-video-buffering")||this.player().addClass("vjs-panorama-mobile-inline-video-buffering"):this.player().hasClass("vjs-panorama-mobile-inline-video-buffering")&&this.player().removeClass("vjs-panorama-mobile-inline-video-buffering")}}this.render()}},render:function(){if(!this.isUserInteracting){var e=this.lat>this.settings.initLat?-1:1,i=this.lon>this.settings.initLon?-1:1;this.settings.backToVerticalCenter&&(this.lat=this.lat>this.settings.initLat-Math.abs(this.settings.returnStepLat)&&this.lat<this.settings.initLat+Math.abs(this.settings.returnStepLat)?this.settings.initLat:this.lat+this.settings.returnStepLat*e),this.settings.backToHorizonCenter&&(this.lon=this.lon>this.settings.initLon-Math.abs(this.settings.returnStepLon)&&this.lon<this.settings.initLon+Math.abs(this.settings.returnStepLon)?this.settings.initLon:this.lon+this.settings.returnStepLon*i)}this.lat=Math.max(this.settings.minLat,Math.min(this.settings.maxLat,this.lat)),this.lon=Math.max(this.settings.minLon,Math.min(this.settings.maxLon,this.lon)),this.phi=t.Math.degToRad(90-this.lat),this.theta=t.Math.degToRad(this.lon),this.supportVideoTexture||this.helperCanvas.update(),this.renderer.clear()},playOnMobile:function(){this.isPlayOnMobile=!0,this.settings.autoMobileOrientation&&window.addEventListener("devicemotion",this.handleMobileOrientation.bind(this))},el:function(){return this.el_}}},I=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=j(e,t,i);return F.extend(n,{constructor:function(e,i){n.constructor.call(this,e,i),this.VRMode=!1,this.scene=new t.Scene,this.camera=new t.PerspectiveCamera(i.initFov,this.width/this.height,1,2e3),this.camera.target=new t.Vector3(0,0,0);var a="equirectangular"===this.videoType?new t.SphereGeometry(500,60,40):new t.SphereBufferGeometry(500,60,40).toNonIndexed();if("panorama"===this.videoType)a=new t.CylinderGeometry(10,10,20,12,1,!0,0,Math.PI);else if("panoramaBuffer"===this.videoType)a=new t.CylinderBufferGeometry(10,10,20,12,1,!0,0,Math.PI);else if("fisheye"===this.videoType){for(var s=a.attributes.normal.array,o=a.attributes.uv.array,r=0,h=s.length/3;r<h;r++){var c=s[3*r+0],l=s[3*r+1],d=s[3*r+2],u=Math.asin(Math.sqrt(c*c+d*d)/Math.sqrt(c*c+l*l+d*d))/Math.PI;l<0&&(u=1-u);var m=0==c&&0==d?0:Math.acos(c/Math.sqrt(c*c+d*d));d<0&&(m*=-1),o[2*r+0]=-.8*u*Math.cos(m)+.5,o[2*r+1]=.8*u*Math.sin(m)+.5}a.rotateX(i.rotateX),a.rotateY(i.rotateY),a.rotateZ(i.rotateZ)}else if("dual_fisheye"===this.videoType){for(var p=a.attributes.normal.array,v=a.attributes.uv.array,g=p.length/3,f=0;f<g/2;f++){var w=p[3*f+0],b=p[3*f+1],y=p[3*f+2],M=0==w&&0==y?1:Math.acos(b)/Math.sqrt(w*w+y*y)*(2/Math.PI);v[2*f+0]=w*i.dualFish.circle1.rx*M*i.dualFish.circle1.coverX+i.dualFish.circle1.x,v[2*f+1]=y*i.dualFish.circle1.ry*M*i.dualFish.circle1.coverY+i.dualFish.circle1.y}for(var x=g/2;x<g;x++){var L=p[3*x+0],T=p[3*x+1],k=p[3*x+2],R=0==L&&0==k?1:Math.acos(-T)/Math.sqrt(L*L+k*k)*(2/Math.PI);v[2*x+0]=-L*i.dualFish.circle2.rx*R*i.dualFish.circle2.coverX+i.dualFish.circle2.x,v[2*x+1]=k*i.dualFish.circle2.ry*R*i.dualFish.circle2.coverY+i.dualFish.circle2.y}a.rotateX(i.rotateX),a.rotateY(i.rotateY),a.rotateZ(i.rotateZ)}a.scale(-1,1,1),this.mesh=new t.Mesh(a,new t.MeshBasicMaterial({map:this.texture})),this.scene.add(this.mesh),this.setMaxLatAndLon(this.camera.fov)},enableVR:function(){if(this.VRMode=!0,"undefined"!=typeof vrHMD){var e=vrHMD.getEyeParameters("left"),i=vrHMD.getEyeParameters("right");this.eyeFOVL=e.recommendedFieldOfView,this.eyeFOVR=i.recommendedFieldOfView}this.cameraL=new t.PerspectiveCamera(this.camera.fov,this.width/2/this.height,1,2e3),this.cameraR=new t.PerspectiveCamera(this.camera.fov,this.width/2/this.height,1,2e3)},disableVR:function(){this.VRMode=!1,this.renderer.setViewport(0,0,this.width,this.height),this.renderer.setScissor(0,0,this.width,this.height)},handleResize:function(){n.handleResize.call(this),this.camera.updateProjectionMatrix(),this.VRMode&&(this.cameraL.aspect=this.camera.aspect/2,this.cameraR.aspect=this.camera.aspect/2,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix())},handleMouseWheel:function(e){n.handleMouseWheel(e),e.wheelDeltaY?this.camera.fov-=.05*e.wheelDeltaY:e.wheelDelta?this.camera.fov-=.05*e.wheelDelta:e.detail&&(this.camera.fov+=1*e.detail),this.camera.fov=Math.min(this.settings.maxFov,this.camera.fov),this.camera.fov=Math.max(this.settings.minFov,this.camera.fov),this.setMaxLatAndLon(this.camera.fov),this.camera.updateProjectionMatrix(),this.VRMode&&(this.cameraL.fov=this.camera.fov,this.cameraR.fov=this.camera.fov,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix())},setMaxLatAndLon:function(e){this.settings.maxLon=this.settings.originalMaxLon-(e-this.settings.minFov)/6*4,this.settings.minLon=this.settings.originalMinLon+(e-this.settings.minFov)/6*4,this.settings.minLat=this.settings.originalMinLat+(e-this.settings.minFov)/6*3,this.settings.maxLat=this.settings.originalMaxLat-(e-this.settings.minFov)/6*3},handleTouchMove:function(e){if(n.handleTouchMove.call(this,e),this.isUserPinch){var t=F.getTouchesDistance(e.touches);e.wheelDeltaY=2*(t-this.multiTouchDistance),this.handleMouseWheel.call(this,e),this.multiTouchDistance=t}},render:function(){if(n.render.call(this),this.camera.target.x=500*Math.sin(this.phi)*Math.cos(this.theta),this.camera.target.y=500*Math.cos(this.phi),this.camera.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.camera.lookAt(this.camera.target),this.VRMode){var e=this.width/2,i=this.height;if("undefined"!=typeof vrHMD)this.cameraL.projectionMatrix=F.fovToProjection(this.eyeFOVL,!0,this.camera.near,this.camera.far),this.cameraR.projectionMatrix=F.fovToProjection(this.eyeFOVR,!0,this.camera.near,this.camera.far);else{var a=this.lon+this.settings.VRGapDegree,s=this.lon-this.settings.VRGapDegree,o=t.Math.degToRad(a),r=t.Math.degToRad(s),h=F.deepCopy(this.camera.target);h.x=500*Math.sin(this.phi)*Math.cos(o),h.z=500*Math.sin(this.phi)*Math.sin(o),this.cameraL.lookAt(h);var c=F.deepCopy(this.camera.target);c.x=500*Math.sin(this.phi)*Math.cos(r),c.z=500*Math.sin(this.phi)*Math.sin(r),this.cameraR.lookAt(c)}this.renderer.setViewport(0,0,e,i),this.renderer.setScissor(0,0,e,i),this.renderer.render(this.scene,this.cameraL),this.renderer.setViewport(e,0,e,i),this.renderer.setScissor(e,0,e,i),this.renderer.render(this.scene,this.cameraR)}else this.renderer.render(this.scene,this.camera)}})},A=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=j(e,t,i);return F.extend(n,{constructor:function(e,i){n.constructor.call(this,e,i),this.VRMode=!1,this.scene=new t.Scene;var a=this.width/this.height;this.cameraL=new t.PerspectiveCamera(i.initFov,a,1,2e3),this.cameraL.target=new t.Vector3(0,0,0),this.cameraR=new t.PerspectiveCamera(i.initFov,a/2,1,2e3),this.cameraR.position.set(1e3,0,0),this.cameraR.target=new t.Vector3(1e3,0,0);for(var s=new t.SphereBufferGeometry(500,60,40).toNonIndexed(),o=new t.SphereBufferGeometry(500,60,40).toNonIndexed(),r=s.attributes.uv.array,h=s.attributes.normal.array,c=0;c<h.length/3;c++)r[2*c+1]=r[2*c+1]/2;for(var l=o.attributes.uv.array,d=o.attributes.normal.array,c=0;c<d.length/3;c++)l[2*c+1]=l[2*c+1]/2+.5;s.scale(-1,1,1),o.scale(-1,1,1),this.meshL=new t.Mesh(s,new t.MeshBasicMaterial({map:this.texture})),this.meshR=new t.Mesh(o,new t.MeshBasicMaterial({map:this.texture})),this.meshR.position.set(1e3,0,0),this.scene.add(this.meshL),i.callback&&i.callback()},handleResize:function(){n.handleResize.call(this);var e=this.width/this.height;this.VRMode?(e/=2,this.cameraL.aspect=e,this.cameraR.aspect=e,this.cameraL.updateProjectionMatrix(),this.cameraR.updateProjectionMatrix()):(this.cameraL.aspect=e,this.cameraL.updateProjectionMatrix())},handleMouseWheel:function(e){n.handleMouseWheel(e),e.wheelDeltaY?this.cameraL.fov-=.05*e.wheelDeltaY:e.wheelDelta?this.cameraL.fov-=.05*e.wheelDelta:e.detail&&(this.cameraL.fov+=1*e.detail),this.cameraL.fov=Math.min(this.settings.maxFov,this.cameraL.fov),this.cameraL.fov=Math.max(this.settings.minFov,this.cameraL.fov),this.cameraL.updateProjectionMatrix(),this.VRMode&&(this.cameraR.fov=this.cameraL.fov,this.cameraR.updateProjectionMatrix())},enableVR:function(){this.VRMode=!0,this.scene.add(this.meshR),this.handleResize()},disableVR:function(){this.VRMode=!1,this.scene.remove(this.meshR),this.handleResize()},render:function(){if(n.render.call(this),this.cameraL.target.x=500*Math.sin(this.phi)*Math.cos(this.theta),this.cameraL.target.y=500*Math.cos(this.phi),this.cameraL.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.cameraL.lookAt(this.cameraL.target),this.VRMode){var e=this.width/2,t=this.height;this.cameraR.target.x=1e3+500*Math.sin(this.phi)*Math.cos(this.theta),this.cameraR.target.y=500*Math.cos(this.phi),this.cameraR.target.z=500*Math.sin(this.phi)*Math.sin(this.theta),this.cameraR.lookAt(this.cameraR.target),this.renderer.setViewport(0,0,e,t),this.renderer.setScissor(0,0,e,t),this.renderer.render(this.scene,this.cameraL),this.renderer.setViewport(e,0,e,t),this.renderer.setScissor(e,0,e,t),this.renderer.render(this.scene,this.cameraR)}else this.renderer.render(this.scene,this.cameraL)}})},O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z=document.createElement("canvas");z.className="vjs-video-helper-canvas";var _,N="undefined"==typeof Symbol?function(e){return"@"+(e||"@")+Math.random()}:Symbol,W="object-fit"in document.head.style&&/iPhone|iPod/i.test(navigator.userAgent)&&!matchMedia("(-webkit-video-playable-inline)").matches,Y=N(),q=N(),H=N("nativeplay"),G=N("nativepause"),U=[],B=0;k.isWhitelisted=W;var X=F.mobileAndTabletcheck(),Z={clickAndDrag:X,showNotice:!0,NoticeMessage:"Please use your mouse drag and drop the video.",autoHideNotice:10,scrollable:!0,initFov:75,maxFov:75,minFov:15,initLat:0,initLon:180,originalInitLat:0,originalInitLon:180,returnStepLat:.5,returnStepLon:2,backToVerticalCenter:!0,backToHorizonCenter:!0,clickToToggle:!1,minLat:-38,maxLat:38,minLon:108,maxLon:252,videoType:"equirectangular",rotateX:0,rotateY:0,rotateZ:0,autoMobileOrientation:!1,mobileVibrationValue:F.isIos()?.022:1,VREnable:!0,VRGapDegree:2.5,closePanorama:!1,helperCanvas:{},dualFish:{width:1920,height:1080,circle1:{x:.240625,y:.553704,rx:.23333,ry:.43148,coverX:.913,coverY:.9},circle2:{x:.757292,y:.553704,rx:.232292,ry:.4296296,coverX:.913,coverY:.9308}}},K=function(e,t,i){if(e.addClass("vjs-panorama"),!E.webgl)return $(e,{NoticeMessage:E.getWebGLErrorMessage(),autoHideNotice:t.autoHideNotice}),void(t.callback&&t.callback());e.addChild("Canvas",F.deepCopy(t));var n=e.getChild("Canvas");if(X){var a=i.getTech(e);F.isRealIphone()&&(a.setAttribute("playsinline",""),k(a,!0)),F.isIos()&&P(e,i.getFullscreenToggleClickFn(e)),e.addClass("vjs-panorama-mobile-inline-video"),e.removeClass("vjs-using-native-controls"),n.playOnMobile()}t.showNotice&&e.on("playing",function(){$(e,F.deepCopy(t))}),t.VREnable&&e.controlBar.addChild("VRButton",{},e.controlBar.children().length-1),n.hide(),e.on("play",function(){n.show()}),e.on("fullscreenchange",function(){n.handleResize()}),t.callback&&t.callback()},$=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{NoticeMessage:""},i=e.addChild("Notice",t);t.autoHideNotice>0&&setTimeout(function(){i.addClass("vjs-video-notice-fadeOut");var e=F.whichTransitionEvent(),t=function t(){i.hide(),i.removeClass("vjs-video-notice-fadeOut"),i.off(e,t)};i.on(e,t)},t.autoHideNotice)};console.log("THREE : "),console.log(THREE);var J={},Q=e.getComponent("Component"),ee=function(e){var t=document.createElement("div");return t.className="vjs-video-notice-label",{constructor:function(i,n){"object"==O(n.NoticeMessage)?(t=n.NoticeMessage,n.el=n.NoticeMessage):"string"==typeof n.NoticeMessage&&(t.innerHTML=n.NoticeMessage,n.el=t),e.call(this,i,n)},el:function(){return t}}}(Q);e.registerComponent("Notice",e.extend(Q,ee));var te=function(e){return{constructor:function(t,i){this.videoElement=i.video,this.width=i.width,this.height=i.height,z.width=this.width,z.height=this.height,z.style.display="none",i.el=z,this.context=z.getContext("2d"),this.context.drawImage(this.videoElement,0,0,this.width,this.height),e.call(this,t,i)},getContext:function(){return this.context},update:function(){this.context.drawImage(this.videoElement,0,0,this.width,this.height)},el:function(){return z}}}(Q);e.registerComponent("HelperCanvas",e.extend(Q,te));var ie=e.getComponent("Button"),ne=function(e){return{constructor:function(t,i){e.call(this,t,i)},buildCSSClass:function(){return"vjs-VR-control "+e.prototype.buildCSSClass.call(this)},handleClick:function(){var e=this.player().getChild("Canvas");e.VRMode?e.disableVR():e.enableVR(),e.VRMode?this.addClass("enable"):this.removeClass("enable"),e.VRMode?this.player().trigger("VRModeOn"):this.player().trigger("VRModeOff")},controlText_:"VR"}}(ie);e.registerComponent("VRButton",e.extend(ie,ne)),e.plugin("panorama",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=["equirectangular","panorama","panoramaBuffer","fisheye","3dVideo","dual_fisheye"],i=function(i){var n=this;e.mergeOption&&(i=e.mergeOption(Z,i)),void 0!==e._init&&"function"==typeof e._init?(-1==t.indexOf(i.videoType)&&(i.videoType=Z.videoType),e._init(i),this.ready(function(){K(n,i,e)})):console.error("plugin must implement init function().")};return i.VERSION="__VERSION__",i}({_init:function(t){var i="3dVideo"!==t.videoType?I(Q,window.THREE,{getTech:C}):A(Q,window.THREE,{getTech:C});e.registerComponent("Canvas",e.extend(Q,i))},mergeOption:function(t,i){return e.mergeOptions(t,i)},getTech:C,getFullscreenToggleClickFn:V}));var ae=function(e,t){setTimeout(function(t){console.log("Script Start");var i=e.getChild("Canvas");i&&(console.log("Script Exsit"),i.setMyPlayScript(t),i.handleMyPlayScript())}.bind(null,t),1e3)},se=function(e,t){e.addClass("vjs-myplay-panorama"),t.width,function(){return/iPhone|iPod/i.test(navigator.platform)}()&&(function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}}()[0]<=5?t.stream=t.streamOldIPhone:t.stream=t.streamNewIPhone),e.src({src:t.stream,type:"application/x-mpegURL",withCredentials:!1}),e.panorama({clickToToggle:!S(),clickAndDrag:!0,autoMobileOrientation:!1,VREnable:S(),NoticeMessage:S()?"please drag and drop the video":"",originalMinLat:-38,originalMaxLat:38,videoType:"panorama",originalMinLon:108,originalMaxLon:252,callback:function(){S()||e.play(),console.log(e)}}),null!=t.cameraDirection&&ae(e,t.cameraDirection)},oe=function(t){var i=this;this.ready(function(){se(i,e.mergeOptions(J,t))})};return(e.registerPlugin||e.plugin)("myplayPanorama",oe),oe.VERSION="0.1.1",oe});